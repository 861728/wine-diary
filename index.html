<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Wine Diary</title>
    
    <!-- Fonts: Pretendard -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif !important;
            background-color: #FFFFFF;
            color: #37352F;
            -webkit-font-smoothing: antialiased;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
            margin: 0;
            overflow-x: hidden;
        }
        
        h1, h2, h3, h4, p, span, div, input, textarea, button {
            font-family: 'Pretendard', sans-serif !important;
            letter-spacing: -0.01em;
        }

        .notion-block {
            border: 1px solid #EDECE9;
            border-radius: 14px;
            background: white;
            transition: all 0.15s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.02);
        }

        .notion-block:active { background: #F1F1EF; transform: scale(0.99); }

        .notion-input {
            width: 100%;
            padding: 14px;
            border: 1px solid #EDECE9;
            border-radius: 10px;
            background: #F7F7F5;
            outline: none;
            font-size: 16px;
            color: #37352F;
            appearance: none;
        }

        .notion-input:focus { border-color: #2383E2; background: white; box-shadow: inset 0 0 0 1px #2383E2; }

        .safe-bottom { padding-bottom: env(safe-area-inset-bottom, 24px); }

        .icon-box { display: flex; align-items: center; justify-content: center; flex-shrink: 0; user-select: none; }
        .icon-img { width: 100%; height: 100%; object-fit: contain; }

        .loader {
            width: 28px;
            height: 28px;
            border: 3px solid #F1F1EF;
            border-top: 3px solid #37352F;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .ai-glow { box-shadow: 0 0 15px rgba(35, 131, 226, 0.1); border-color: rgba(35, 131, 226, 0.2); }
        #root { min-height: 100vh; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- Configuration & Constants ---
        const GEMINI_API_KEY = ""; 

        const WINE_TYPES = ["Red", "White", "Rose", "Sparkling"];
        const COLOR_MAP = {
            "White": ["Lemon", "Gold", "Amber"],
            "Red": ["Purple", "Ruby", "Garnet"],
            "Rose": ["Pink", "Salmon", "Onion Skin"],
            "Sparkling": ["Pale Gold", "Deep Gold"]
        };
        const AROMA_CATEGORIES = {
            "Fruit": ["Citrus", "Peach/Apricot", "Strawberry", "Cherry", "Blackberry", "Blueberry", "Pineapple"],
            "Floral & Herbal": ["Acacia", "Rose", "Fresh Grass", "Mint", "Lavender"],
            "Tertiary & Oak": ["Vanilla", "Toast", "Chocolate", "Coffee", "Leather", "Earth", "Smoke", "Nutty"]
        };
        const STRUCTURE_CONFIG = [
            { id: "sweetness", label: "Sweetness", levels: ["Dry", "Off-Dry", "Sweet"] },
            { id: "acidity", label: "Acidity", levels: ["Low", "Medium", "High"] },
            { id: "tannin", label: "Tannin", levels: ["Soft", "Firm", "Harsh"] },
            { id: "body", label: "Body", levels: ["Light", "Medium", "Full"] },
            { id: "finish", label: "Finish", levels: ["Short", "Medium", "Long"] }
        ];

        const Icon3D = ({ name, size = 24, className = "" }) => {
            const iconMap = {
                database: { code: "1f4d1", char: "üìë" },
                wine: { code: "1f377", char: "üç∑" },
                home: { code: "1f3e0", char: "üè†" },
                archive: { code: "1f4da", char: "üìö" },
                add: { code: "1f4dd", char: "üìù" },
                book: { code: "1f4d6", char: "üìñ" },
                history: { code: "1f552", char: "üïí" },
                camera: { code: "1f4f8", char: "üì∏" },
                search: { code: "1f50d", char: "üîç" },
                star: { code: "2b50", char: "‚≠ê" },
                edit: { code: "270f", char: "‚úèÔ∏è" },
                delete: { code: "1f5d1", char: "üóëÔ∏è" },
                calendar: { code: "1f4c5", char: "üìÖ" },
                location: { code: "1f4cd", char: "üìç" },
                quote: { code: "1f4ac", char: "üí¨" },
                arrowLeft: { code: "2b05", char: "‚¨ÖÔ∏è" },
                sparkles: { code: "2728", char: "‚ú®" },
                utensils: { code: "1f374", char: "üç¥" },
                discovery: { code: "1f9ed", char: "üß≠" },
                download: { code: "1f4e5", char: "üì•" },
                upload: { code: "1f4e4", char: "üì§" },
                tongue: { code: "1f445", char: "üëÖ" },
                nose: { code: "1f443", char: "üëÉ" },
                droplet: { code: "1f4a7", char: "üíß" }
            };
            const item = iconMap[name] || { code: "2753", char: "‚ùì" };
            const [imgError, setImgError] = useState(false);
            const url = `https://fonts.gstatic.com/s/e/notoemoji/latest/${item.code}/512.webp`;

            return (
                <div className={`icon-box ${className}`} style={{ width: size, height: size }}>
                    {!imgError ? (
                        <img src={url} alt={name} className="icon-img" onError={() => setImgError(true)} />
                    ) : (
                        <span style={{ fontSize: size * 0.85 }}>{item.char}</span>
                    )}
                </div>
            );
        };

        const fetchGemini = async (prompt) => {
            if (!GEMINI_API_KEY) return "AI Key Required";
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${GEMINI_API_KEY}`;
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
            });
            const result = await response.json();
            return result.candidates?.[0]?.content?.parts?.[0]?.text || "No AI response";
        };

        const App = () => {
            const [wines, setWines] = useState([]);
            const [view, setView] = useState('dashboard');
            const [currentWine, setCurrentWine] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [isGenerating, setIsGenerating] = useState(false);
            const [isLoading, setIsLoading] = useState(true);
            const [aiPairing, setAiPairing] = useState(null);
            const [aiRecommendation, setAiRecommendation] = useState(null);
            const backupFileRef = useRef(null);

            // --- üì± Data Loading ---
            useEffect(() => {
                const localData = localStorage.getItem('WINE_DIARY_ULTIMATE_DB');
                if (localData) {
                    try { setWines(JSON.parse(localData)); } catch (e) { console.error(e); }
                }
                setIsLoading(false);
            }, []);

            useEffect(() => {
                if (!isLoading) {
                    localStorage.setItem('WINE_DIARY_ULTIMATE_DB', JSON.stringify(wines));
                }
            }, [wines, isLoading]);

            const handleBackupExport = () => {
                const dataStr = JSON.stringify(wines, null, 2);
                const blob = new Blob([dataStr], { type: "application/json" });
                const url = URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.href = url;
                link.download = `wine_diary_backup_${new Date().toISOString().slice(0,10)}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const handleBackupImport = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        if (Array.isArray(importedData)) {
                            setWines(importedData);
                            alert("Restore Complete!");
                        }
                    } catch (err) { alert("Invalid backup file."); }
                };
                reader.readAsText(file);
            };

            const handleSave = () => {
                if (!currentWine?.name) return;
                if (currentWine.id) setWines(wines.map(w => w.id === currentWine.id ? currentWine : w));
                else setWines([{ ...currentWine, id: Date.now().toString(), createdAt: Date.now() }, ...wines]);
                setView('list');
            };

            const handleDelete = (id) => {
                if(!confirm('Permanently delete?')) return;
                setWines(wines.filter(w => w.id !== id));
                setView('list');
            };

            if (isLoading) return <div className="h-screen flex items-center justify-center bg-white"><div className="loader"></div></div>;

            return (
                <div className="min-h-screen bg-white">
                    <main className="max-w-md mx-auto px-6 pt-16 pb-48">
                        
                        {/* --- DASHBOARD --- */}
                        {view === 'dashboard' && (
                            <div className="space-y-12 animate-in fade-in">
                                <header className="space-y-2">
                                    <div className="flex items-center gap-3"><Icon3D name="database" size={36} /><h1 className="text-3xl font-bold tracking-tight text-[#37352F]">Wine Diary</h1></div>
                                    <p className="text-sm text-stone-400 font-medium ml-1">Your local wine archives.</p>
                                </header>
                                <div className="space-y-4">
                                    <div className="p-6 notion-block flex items-center justify-between shadow-sm">
                                        <div className="flex items-center gap-5">
                                            <div className="w-14 h-14 bg-stone-50 rounded-xl flex items-center justify-center shadow-inner"><Icon3D name="wine" size={40} /></div>
                                            <div><p className="text-[10px] font-bold text-stone-400 uppercase tracking-widest mb-1">Total Bottles</p><p className="text-3xl font-bold text-[#37352F]">{wines.length}</p></div>
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div onClick={() => setView('list')} className="p-6 notion-block cursor-pointer flex flex-col gap-4 active:bg-stone-50 transition-colors"><Icon3D name="book" size={32} /><span className="text-sm font-bold text-[#37352F]">Index</span></div>
                                        <div onClick={() => { if(wines.length > 0) { setCurrentWine(wines[0]); setView('detail'); }}} className="p-6 notion-block cursor-pointer flex flex-col gap-4 active:bg-stone-50 transition-colors"><Icon3D name="history" size={32} /><span className="text-sm font-bold text-[#37352F]">Latest</span></div>
                                    </div>
                                    <div 
                                        onClick={() => { 
                                            setCurrentWine({ name: '', producer: '', vintage: '', variety: '', region: '', type: 'Red', color: '', aromas: [], structure: { sweetness: 0, acidity: 0, tannin: 0, body: 0, finish: 0 }, date: new Date().toISOString().split('T')[0], rating: 5, comment: '', imageUrl: null }); 
                                            setAiPairing(null); setAiRecommendation(null); setView('edit'); 
                                        }}
                                        className="p-14 notion-block bg-[#F7F7F5] border-dashed border-2 cursor-pointer flex flex-col items-center justify-center gap-4 active:bg-stone-200 transition-colors"
                                    >
                                        <Icon3D name="camera" size={56} /><p className="text-[11px] font-bold text-stone-500 uppercase tracking-widest">New Page</p>
                                    </div>
                                </div>

                                <div className="space-y-4 pt-10 border-t border-stone-100">
                                    <h3 className="text-[11px] font-black text-stone-300 uppercase tracking-widest ml-1">Tools</h3>
                                    <div className="grid grid-cols-2 gap-3">
                                        <button onClick={handleBackupExport} className="p-4 notion-block flex items-center gap-3 active:bg-stone-50"><Icon3D name="download" size={20} /><span className="text-xs font-bold text-[#37352F]">Export</span></button>
                                        <button onClick={() => backupFileRef.current.click()} className="p-4 notion-block flex items-center gap-3 active:bg-stone-50"><Icon3D name="upload" size={20} /><span className="text-xs font-bold text-[#37352F]">Import</span></button>
                                        <input type="file" ref={backupFileRef} className="hidden" accept=".json" onChange={handleBackupImport} />
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* --- LIST VIEW --- */}
                        {view === 'list' && (
                            <div className="space-y-8 animate-in fade-in">
                                <header className="flex justify-between items-center px-1"><h2 className="text-2xl font-bold text-[#37352F] flex items-center gap-3"><Icon3D name="archive" size={28} /> Archive</h2><button onClick={() => setView('dashboard')} className="text-xs font-bold text-stone-400 uppercase tracking-widest">Back</button></header>
                                <div className="relative"><div className="absolute left-4 top-1/2 -translate-y-1/2"><Icon3D name="search" size={20} /></div><input className="notion-input pl-12" placeholder="Search records..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} /></div>
                                <div className="divide-y divide-stone-100">
                                    {wines.filter(w => w.name.toLowerCase().includes(searchTerm.toLowerCase())).map((wine) => (
                                        <div key={wine.id} onClick={() => { setCurrentWine(wine); setAiPairing(null); setAiRecommendation(null); setView('detail'); }} className="py-5 flex items-center gap-5 cursor-pointer hover:bg-stone-50 px-2 rounded-xl">
                                            <div className="w-16 h-16 bg-stone-50 rounded-lg border border-stone-100 flex items-center justify-center overflow-hidden shrink-0">{wine.imageUrl ? <img src={wine.imageUrl} className="w-full h-full object-cover" /> : <Icon3D name="wine" size={32} />}</div>
                                            <div className="flex-1 min-w-0"><p className="text-base font-bold text-[#37352F] truncate">{wine.name}</p><p className="text-xs text-stone-400 font-medium truncate uppercase">{wine.variety} ¬∑ {wine.vintage || 'NV'}</p></div>
                                            <div className="flex items-center gap-1.5 px-2 py-1 bg-stone-50 rounded-md"><Icon3D name="star" size={14} /><span className="text-xs font-bold text-[#37352F]">{wine.rating}</span></div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* --- DETAIL VIEW --- */}
                        {view === 'detail' && currentWine && (
                            <div className="space-y-10 animate-in fade-in pb-10">
                                <header className="flex justify-between items-center px-1">
                                    <button onClick={() => setView('list')} className="text-xs font-bold text-[#2383E2] flex items-center gap-3 uppercase tracking-widest hover:underline"><Icon3D name="arrowLeft" size={16} /> Index</button>
                                    <div className="flex gap-6"><div className="cursor-pointer" onClick={() => setView('edit')}><Icon3D name="edit" size={28} /></div><div className="cursor-pointer" onClick={() => handleDelete(currentWine.id)}><Icon3D name="delete" size={28} /></div></div>
                                </header>
                                <div className="space-y-12">
                                    <div className="w-full aspect-square bg-stone-50 rounded-3xl overflow-hidden border border-stone-100 shadow-sm">{currentWine.imageUrl ? <img src={currentWine.imageUrl} className="w-full h-full object-cover" /> : <div className="w-full h-full flex items-center justify-center bg-stone-50"><Icon3D name="wine" size={100} /></div>}</div>
                                    <div className="space-y-2 px-1">
                                        <div className="flex items-center gap-2 mb-1"><span className={`px-2 py-0.5 rounded text-[10px] font-bold text-white ${currentWine.type === 'Red' ? 'bg-red-500' : currentWine.type === 'White' ? 'bg-yellow-400' : currentWine.type === 'Rose' ? 'bg-pink-400' : 'bg-blue-400'}`}>{currentWine.type}</span><span className="text-[10px] font-bold text-stone-300">{currentWine.color}</span></div>
                                        <h2 className="text-4xl font-bold leading-tight tracking-tight text-[#37352F]">{currentWine.name}</h2>
                                        <p className="text-lg text-stone-400 font-medium">{currentWine.producer || 'Unknown Producer'}</p>
                                    </div>
                                    <div className="border-y border-stone-100 divide-y divide-stone-100">
                                        {[ { label: 'Date', icon: 'calendar', value: currentWine.date }, { label: 'Region', icon: 'location', value: currentWine.region || '-' } ].map((item, idx) => (
                                            <div key={idx} className="flex items-center py-5"><div className="w-36 text-[11px] font-black text-stone-400 uppercase tracking-widest flex items-center gap-4"><Icon3D name={item.icon} size={22} /> {item.label}</div><div className={`flex-1 text-sm font-semibold text-[#37352F]`}>{item.value}</div></div>
                                        ))}
                                        
                                        <div className="py-5">
                                            <div className="text-[11px] font-black text-stone-400 uppercase tracking-widest flex items-center gap-4 mb-3"><Icon3D name="nose" size={22} /> Aroma</div>
                                            <div className="flex flex-wrap gap-2">
                                                {currentWine.aromas?.length > 0 ? currentWine.aromas.map(a => <span key={a} className="px-3 py-1 bg-stone-100 text-[#37352F] text-[11px] font-bold rounded-full">{a}</span>) : <span className="text-stone-300 text-[11px] italic">No aromas logged.</span>}
                                            </div>
                                        </div>

                                        <div className="py-5">
                                            <div className="text-[11px] font-black text-stone-400 uppercase tracking-widest flex items-center gap-4 mb-4"><Icon3D name="tongue" size={22} /> Structure</div>
                                            <div className="grid grid-cols-2 gap-x-8 gap-y-4 px-1">
                                                {STRUCTURE_CONFIG.map(s => (
                                                    <div key={s.id} className="flex justify-between items-center text-[13px]">
                                                        <span className="text-stone-400 font-bold uppercase tracking-tighter">{s.label}</span>
                                                        <span className="font-bold text-[#37352F]">{s.levels[currentWine.structure?.[s.id] || 0]}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-2 gap-4">
                                        <button onClick={async () => { setIsGenerating(true); try { const text = await fetchGemini(`Food pairing for ${currentWine.name}. One sentence.`); setAiPairing(text); } catch (e) {} finally { setIsGenerating(false); } }} className="p-5 notion-block flex flex-col items-center gap-3 ai-glow active:bg-blue-50 transition-colors"><Icon3D name="utensils" size={32} /><span className="text-[10px] font-bold text-[#2383E2] uppercase tracking-widest">‚ú® Pairing</span></button>
                                        <button onClick={async () => { setIsGenerating(true); try { const text = await fetchGemini(`Recommend a similar wine to ${currentWine.name}. One sentence.`); setAiRecommendation(text); } catch (e) {} finally { setIsGenerating(false); } }} className="p-5 notion-block flex flex-col items-center gap-3 ai-glow active:bg-blue-50 transition-colors"><Icon3D name="discovery" size={32} /><span className="text-[10px] font-bold text-[#2383E2] uppercase tracking-widest">‚ú® Next Wine</span></button>
                                    </div>
                                    
                                    {(aiPairing || aiRecommendation) && (
                                        <div className="space-y-4 animate-in slide-in-from-top-2">
                                            {aiPairing && <div className="p-6 bg-green-50 rounded-2xl text-sm italic text-green-800">"{aiPairing}"</div>}
                                            {aiRecommendation && <div className="p-6 bg-blue-50 rounded-2xl text-sm italic text-blue-800">"{aiRecommendation}"</div>}
                                        </div>
                                    )}

                                    <div className="p-8 bg-[#F7F7F5] rounded-3xl border border-stone-100 relative overflow-hidden">
                                        <div className="absolute -top-4 -right-4 opacity-10"><Icon3D name="quote" size={100} /></div>
                                        <div className="flex items-center gap-3 mb-5 text-stone-400"><Icon3D name="edit" size={18} /> <span className="text-[10px] font-black uppercase tracking-widest">Taste Note</span></div>
                                        <p className="text-lg leading-relaxed text-stone-700 font-medium italic relative z-10">"{currentWine.comment || 'No notes added yet.'}"</p>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* --- EDIT VIEW --- */}
                        {view === 'edit' && currentWine && (
                            <div className="space-y-12 animate-in fade-in pb-24">
                                <header className="flex justify-between items-center px-1"><button onClick={() => setView('dashboard')} className="text-xs font-bold text-stone-400 uppercase tracking-widest">Cancel</button><button onClick={handleSave} className="text-xs font-bold text-[#2383E2] bg-blue-50 px-6 py-2.5 rounded-xl active:opacity-70">Done</button></header>
                                <div className="space-y-10 px-1">
                                    <div className="space-y-8">
                                        <div className="space-y-3"><label className="text-[10px] font-black text-stone-400 uppercase tracking-widest ml-1">Title</label><input className="notion-input font-bold text-lg text-[#37352F]" value={currentWine.name} onChange={e => setCurrentWine({...currentWine, name: e.target.value})} placeholder="Wine name..." /></div>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div className="space-y-3"><label className="text-[10px] font-black text-stone-400 uppercase tracking-widest ml-1">Year</label><input className="notion-input" value={currentWine.vintage} onChange={e => setCurrentWine({...currentWine, vintage: e.target.value})} placeholder="Year" /></div>
                                            <div className="space-y-3"><label className="text-[10px] font-black text-stone-400 uppercase tracking-widest ml-1">Grape</label><input className="notion-input" value={currentWine.variety} onChange={e => setCurrentWine({...currentWine, variety: e.target.value})} placeholder="Variety" /></div>
                                        </div>
                                    </div>

                                    {/* --- TYPE & COLOR --- */}
                                    <div className="space-y-6 pt-4 border-t border-stone-100">
                                        <div className="flex justify-between items-end"><label className="text-[10px] font-black text-stone-400 uppercase tracking-widest ml-1">Type & Color</label>
                                            <select className="text-[11px] font-bold text-stone-400 bg-transparent" value={currentWine.type} onChange={e => setCurrentWine({...currentWine, type: e.target.value, color: ''})}>
                                                {WINE_TYPES.map(t => <option key={t} value={t}>{t} Wine</option>)}
                                            </select>
                                        </div>
                                        <div className="flex flex-wrap gap-2">
                                            {COLOR_MAP[currentWine.type].map(c => (
                                                <button key={c} onClick={() => setCurrentWine({...currentWine, color: c})} className={`px-4 py-2 rounded-full text-xs font-bold border transition-all ${currentWine.color === c ? 'bg-[#37352F] text-white border-[#37352F]' : 'bg-white text-stone-400 border-stone-100'}`}>{c}</button>
                                            ))}
                                        </div>
                                    </div>

                                    {/* --- AROMAS --- */}
                                    <div className="space-y-6 pt-4 border-t border-stone-100">
                                        <label className="text-[10px] font-black text-stone-400 uppercase tracking-widest ml-1">Aroma Profile</label>
                                        {Object.entries(AROMA_CATEGORIES).map(([cat, items]) => (
                                            <div key={cat} className="space-y-2">
                                                <p className="text-[10px] font-bold text-stone-300 italic px-1">{cat}</p>
                                                <div className="flex flex-wrap gap-2">
                                                    {items.map(item => (
                                                        <button 
                                                            key={item} 
                                                            onClick={() => {
                                                                const aroms = currentWine.aromas || [];
                                                                setCurrentWine({...currentWine, aromas: aroms.includes(item) ? aroms.filter(a => a !== item) : [...aroms, item]});
                                                            }}
                                                            className={`px-3 py-1.5 rounded-lg text-xs font-bold border transition-all ${currentWine.aromas?.includes(item) ? 'bg-blue-50 text-[#2383E2] border-[#2383E2]' : 'bg-white text-stone-400 border-stone-50'}`}
                                                        >
                                                            {item}
                                                        </button>
                                                    ))}
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    {/* --- STRUCTURE --- */}
                                    <div className="space-y-8 pt-4 border-t border-stone-100">
                                        <label className="text-[10px] font-black text-stone-400 uppercase tracking-widest ml-1">Palate & Structure</label>
                                        {STRUCTURE_CONFIG.map(s => (
                                            <div key={s.id} className="space-y-2">
                                                <div className="flex justify-between text-[10px] font-bold"><span className="text-stone-400 uppercase">{s.label}</span><span className="text-[#2383E2]">{s.levels[currentWine.structure?.[s.id] || 0]}</span></div>
                                                <div className="flex gap-1 bg-stone-50 p-1 rounded-xl">
                                                    {s.levels.map((level, idx) => (
                                                        <button key={level} onClick={() => setCurrentWine({...currentWine, structure: {...currentWine.structure, [s.id]: idx}})} className={`flex-1 py-2 text-[10px] font-bold rounded-lg transition-all ${currentWine.structure?.[s.id] === idx ? 'bg-white text-[#37352F] shadow-sm' : 'text-stone-300'}`}>{idx + 1}</button>
                                                    ))}
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    <div className="space-y-8 pt-4 border-t border-stone-100">
                                        <div className="space-y-3"><label className="text-[10px] font-black text-stone-400 uppercase tracking-widest ml-1">Taste Note</label><textarea className="notion-input h-32 resize-none text-base" value={currentWine.comment} onChange={e => setCurrentWine({...currentWine, comment: e.target.value})} placeholder="Your tasting impressions..." /></div>
                                        <div className="space-y-4">
                                            <div className="flex justify-between items-center px-1"><span className="text-[10px] font-black text-stone-400 uppercase tracking-widest">Star Rating</span><span className="text-xl font-bold text-[#37352F]">{currentWine.rating}/10</span></div>
                                            <div className="flex gap-1.5">{[...Array(10)].map((_, i) => <button key={i} onClick={() => setCurrentWine({...currentWine, rating: i+1})} className={`flex-1 h-10 rounded-lg transition-all ${currentWine.rating >= i+1 ? 'bg-[#37352F]' : 'bg-stone-100'} active:scale-90`} />)}</div>
                                        </div>
                                    </div>
                                    <button onClick={handleSave} className="w-full py-6 bg-[#37352F] text-white rounded-2xl font-bold text-xl active:bg-black transition-colors shadow-xl">Archive Record</button>
                                </div>
                            </div>
                        )}
                    </main>

                    <nav className="fixed bottom-10 left-1/2 -translate-x-1/2 z-50 safe-bottom">
                        <div className="bg-white/95 backdrop-blur-md border border-stone-200 px-10 py-5 rounded-full flex items-center gap-16 shadow-[0_25px_50px_rgba(0,0,0,0.1)]">
                            <button onClick={() => { setAiPairing(null); setAiRecommendation(null); setView('dashboard'); }} className="active:opacity-50 transition-opacity p-1"><Icon3D name="home" size={32} /></button>
                            <button onClick={() => { setAiPairing(null); setAiRecommendation(null); setView('list'); }} className="active:opacity-50 transition-opacity p-1"><Icon3D name="archive" size={32} /></button>
                            <div className="w-[1px] h-6 bg-stone-200" />
                            <button onClick={() => { 
                                setCurrentWine({ name: '', producer: '', vintage: '', variety: '', region: '', type: 'Red', color: '', aromas: [], structure: { sweetness: 0, acidity: 0, tannin: 0, body: 0, finish: 0 }, date: new Date().toISOString().split('T')[0], rating: 5, comment: '', imageUrl: null }); 
                                setAiPairing(null); setAiRecommendation(null); setView('edit'); 
                            }} className="active:opacity-50 transition-opacity p-1"><Icon3D name="add" size={32} /></button>
                        </div>
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
